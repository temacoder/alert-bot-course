//–ü–æ–¥–∫–ª—é—á–∞–µ–º –º–æ–¥—É–ª–∏ NodeJS
const { Telegraf } = require('telegraf')
const schedule = require('node-schedule')

//–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è bot —Ç–æ–∫–µ–Ω–∞ –∏–¥–µ—Ç–µ –≤ @botfather, –≤–≤–æ–¥–∏—Ç–µ —Ç–∞–º –∫–æ–º–∞–Ω–¥—É /newbot –∏ –¥–∞–ª–µ–µ –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏. –ü–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω –≤—Å—Ç–∞–≤–ª—è–µ—Ç–µ üëá
const bot = new Telegraf('—Ç—É—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞—à –±–æ—Ç —Ç–æ–∫–µ–Ω')

//–ö–æ–¥ –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—É /start
bot.start((ctx) => ctx.replyWithHTML('–ü—Ä–∏–≤–µ—Ç! –Ø –º–æ–≥—É –Ω–∞–ø–æ–º–Ω–∏—Ç—å —Ç–µ–±–µ –æ —á–µ–º —É–≥–æ–¥–Ω–æ —Ç–æ–ª—å–∫–æ –ø–æ–ø—Ä–æ—Å–∏.\n–î–ª—è —ç—Ç–æ–≥–æ –æ—Ç–ø—Ä–∞–≤—å –º–Ω–µ –≤—Ä–µ–º—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ\n<b>–î–î.–ú–ú.–ì–ì–ì–ì –ß–ß:–ú–ú:–°–°</b>'))

//–ö–æ–¥ –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ª—é–±–æ–π —Ç–µ–∫—Å—Ç –æ—Ç —é–∑–µ—Ä–∞ –∏ –¥–µ–ª—å—à–µ —á—Ç–æ-—Ç–æ —Å —ç—Ç–∏–º –¥–µ–ª–∞–µ—Ç
//–í –Ω–∞—à–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —Å–ª—É—á–∞–µ –º—ã –ø—Ä–∏–Ω–∏–º–∞–µ–º —Å—Ç—Ä–æ–∫—É —Å –¥–∞—Ç–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º, —Å–æ–∑–¥–∞–µ–º –∏–∑ –Ω–µ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∏ –ø—Ä–æ–≥—Ä–∞–º–∏—Ä—É–µ–º –±–æ—Ç–∞ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –Ω—É–∂–Ω–æ–µ –≤—Ä–µ–º—è
bot.on('text', async (ctx) => {

  //–†–∞–∑–±–∏–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç —é–∑–µ—Ä–∞ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ü–∏—Ñ—Ä—ã (–¥–µ–Ω—å, –º–µ—Å—è—Ü, –≥–æ–¥, —á–∞—Å—ã, –º–∏–Ω—É—Ç—ã) –∏ –ø–æ–ª—É—á–∞–µ–º –º–∞—Å—Å–∏–≤ —Å —ç—Ç–∏–º–∏ —Ü–∏—Ñ—Ä–∞–º–∏
  const dateArray = ctx.update.message.text.split(/[.:\s]/)

  //—Å–æ–∑–¥–∞–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é –º–æ–¥—É–ª—è schedule
  const rule = new schedule.RecurrenceRule()
  rule.date = parseInt(dateArray[0]) //–¥–µ–Ω—å
  rule.month = parseInt(dateArray[1].startsWith('0') ? dateArray[1][1] : dateArray[1]) - 1 //–º–µ—Å—è—Ü
  rule.year = parseInt(dateArray[2]) //–≥–æ–¥
  rule.hour = parseInt(dateArray[3]) //—á–∞—Å—ã
  rule.minute = parseInt(dateArray[4]) //–º–∏–Ω—É—Ç—ã

  //–ó–∞–ø—É—Å–∫–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∫–æ—Ç–æ—Ä–∞—è –∂–¥–µ—Ç –Ω—É–∂–Ω–æ–µ –≤—Ä–µ–º—è –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  schedule.scheduleJob(rule, () => {
    ctx.replyWithHTML(`${ctx.chat.first_name}, –Ω–∞–ø–æ–º–∏–Ω–∞—é —Ç–µ–±–µ, —á—Ç–æ —Ç—ã —á—Ç–æ-—Ç–æ —Ö–æ—Ç–µ–ª —Å–¥–µ–ª–∞—Ç—å üòâ`)
  })
})

//–§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç
bot.launch()